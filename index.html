<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ortasks</title>
</head>
<style>

*{
    margin: 0;
    padding: 0;
}

#add-tasks{
    display: grid;
}
#add-tasks-buttons{
    display: grid;
    grid-template-columns: 1fr 1fr;
}

#sort-tasks-by-value{
    display: none;
}

#sort-tasks-by-effort{
    display: none;
}

#decide-weights{
    display: none;
}

#decide-weights-range{
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    text-align: center;
}

.add-tasks-list-item{
    display: grid;
    grid-template-columns: 4fr 1fr;
}

</style>
<body>

<div id="add-tasks" class="screen">
    <h1>Add Tasks</h1>
    <input id="task-description" type="text" value="Next task">
    <div id="add-tasks-buttons"><button id="next-task">Add task</button><button id="finished-adding-task">Sort tasks</button></div>
    <div id="add-tasks-list">
    </div>
</div>

<div id="sort-tasks-by-value" class="screen">
    <h1>Which task is more valuable?</h1>
    <p><a id="task-a-value" href="#">Task A</a></p>
    <p><a id="task-b-value" href="#">Task B</a></p>
</div>

<div id="sort-tasks-by-effort" class="screen">
    <h1>Which task takes more effort?</h1>
    <p><a id="task-a-effort" href="#">Task A</a></p>
    <p><a id="task-b-effort" href="#">Task B</a></p>
</div>

<div id="decide-weights" class="screen">
    <h1>What do you prefer?</h1>
    <div id="decide-weights-range">
    More Value
    <input type="range" id="weights" name="weights" min="0" max="10">
    LessEffort
    </div>
    <button>Show results!</button>
</div>

<div id="results" class="screen">
    <div id="ordered-tasks-list">
    </div>
</div>

<script>

//order valueWeigthOrder * value + effortValueOrder * effort

const show = (screenId) => {
    for(s of Array.from(document.getElementsByClassName("screen"))){
        s.style.display = "none"
    }
    document.getElementById(screenId).style.display = "grid"
}

let tasks = []
let tasksOrderedByValue = []//0 is more valuable
let tasksOrderedByEffort = []//0 is less effort

let valueWeigth = 1
let effortWeigth = 1

let byValueQuickSort = []
let byEffortQuickSort = []

const reRenderTasks = () => {
    const taskList = document.getElementById("add-tasks-list")
    taskList.innerHTML = ''
    for(task of tasks){
        const div = document.createElement("div")
        div.classList.add("add-tasks-list-item")
        const span = document.createElement("span")
        span.textContent = task.description
        div.appendChild(span)
        const button = document.createElement("button")
        button.textContent = "Delete"
        let description = task.description
        button.addEventListener("click", ()=>{
           tasks = tasks.filter(t => t.description != description)
           reRenderTasks()
        })
        div.appendChild(button)
        taskList.appendChild(div)
    }
}

const compareByValue = (taskA, taskB) => {
    document.getElementById("task-a-value").textContent = taskA.description
    document.getElementById("task-b-value").textContent = taskB.description
    show("sort-tasks-by-value")
}

const nextStepOrderByValue = () => {
    if(byValueQuickSort.length == 0){
        console.log("DONE")
        console.log(tasksOrderedByValue)
        return
    }
    let currentContext = byValueQuickSort[0]
    console.log(currentContext)
    let j = currentContext.j
    let hi = currentContext.hi
    let i = currentContext.i
    if(j < hi){
        compareByValue(tasksOrderedByValue[i], tasksOrderedByValue[hi])    
    }else{
        let tmp = tasksOrderedByValue[hi]
        tasksOrderedByValue[hi] = tasksOrderedByValue[i]
        tasksOrderedByValue[i] = tmp

        let contextSolved = byValueQuickSort.pop()
        if(contextSolved.hi - contextSolved.lo == 1){
            if(tasksOrderedByValue[contextSolved.hi] < tasksOrderedByValue[contextSolved.lo]){
                let tmp = tasksOrderedByValue[contextSolved.hi]
                tasksOrderedByValue[contextSolved.hi] = tasksOrderedByValue[contextSolved.lo]
                tasksOrderedByValue[contextSolved.lo] = tmp
            }
            nextStepOrderByValue()
            return
        }
        let newPivot = Math.floor( (contextSolved.hi + contextSolved.lo) / 2 )
        byValueQuickSort.push({"lo":contextSolved.lo, "hi":newPivot -1, "i": 0, "j": 0})
        byValueQuickSort.push({"lo": newPivot, "hi":contextSolved.hi, "i": 0, "j": 0})
    }
}

document.getElementById("task-b-value").addEventListener("click", ()=>{
    let currentContext = byValueQuickSort[0]
    let j = currentContext.j
    currentContext.j += 1
    //random chance for next sort step so it doesnt get boring
    //if 50% chance do
    nextStepOrderByValue()
//     else nextStepOrderByEffort()
})
document.getElementById("task-a-value").addEventListener("click", ()=>{
    let currentContext = byValueQuickSort[0]
    let i = currentContext.i
    let j = currentContext.j
    currentContext.j += 1
    let tmp = tasksOrderedByValue[j]
    tasksOrderedByValue[j] = tasksOrderedByValue[i]
    tasksOrderedByValue[i] = tmp
    currentContext.i += 1
    //random chance for next sort step so it doesnt get boring
    //if 50% chance do
    nextStepOrderByValue()
//     else nextStepOrderByEffort()
})

const compareByEffort = (taskA, taskB) => {
    document.getElementById("task-a-effort").textContent = taskA.description
    document.getElementById("task-b-effort").textContent = taskB.description
    show("sort-tasks-by-effort")
}

document.getElementById("next-task").addEventListener("click", ()=>{
    const taskDescription = document.getElementById("task-description")
    const value = taskDescription.value
    taskDescription.value = ""
    tasks.push({
        "description": value,
        "effort": 0,
        "value": 0,
        "random": Math.random()
    })
    reRenderTasks()
})

document.getElementById("finished-adding-task").addEventListener("click", ()=>{
    tasks.sort((a, b) => a.random - b.random)
    tasksOrderedByValue = [...tasks]
    tasksOrderedByEffort = [...tasks]
    console.log(tasks)
    byValueQuickSort = [{"lo":0, "hi":tasks.length -1, "i": 0, "j": 0}]
    byEffortQuickSort = [{"lo":0, "hi":tasks.length -1, "i": 0, "j": 0}]
    nextStepOrderByValue()
})

</script>

</body>
</html>